
import React, { useState } from 'react';
import { BookOpen, HelpCircle, Video, FileText, ChevronDown, ChevronUp, PlayCircle, ExternalLink, Zap, Shield, Terminal, LifeBuoy } from 'lucide-react';

const TUTORIALS = [
    {
        id: 1,
        title: "Quick Start: First Deployment",
        description: "Learn how to flash a Raspberry Pi, run the bootstrap script, and enroll your first actor into the fleet.",
        time: "5 min",
        level: "Beginner",
        icon: Terminal,
        color: "text-blue-400",
        bg: "bg-blue-500/10",
        border: "border-blue-500/30"
    },
    {
        id: 2,
        title: "Mastering Personas",
        description: "How to switch device identities (e.g., from Printer to PLC) to deceive different types of attackers.",
        time: "3 min",
        level: "Intermediate",
        icon: Zap,
        color: "text-purple-400",
        bg: "bg-purple-500/10",
        border: "border-purple-500/30"
    },
    {
        id: 3,
        title: "Sentinel Mode & Lockdowns",
        description: "Understanding the 'Paranoid' TCP Sentinel mode and when to use it during an active breach.",
        time: "4 min",
        level: "Advanced",
        icon: Shield,
        color: "text-red-400",
        bg: "bg-red-500/10",
        border: "border-red-500/30"
    },
    {
        id: 4,
        title: "Analyzing Forensic Snapshots",
        description: "A deep dive into reading memory dumps, process trees, and auth logs generated by the forensic tool.",
        time: "8 min",
        level: "Expert",
        icon: FileText,
        color: "text-emerald-400",
        bg: "bg-emerald-500/10",
        border: "border-emerald-500/30"
    }
];

const FAQS = [
    {
        q: "What exactly does the Virtual Puppets agent do?",
        a: "The agent (vpp-agent) is a lightweight daemon that runs on Linux devices (typically Raspberry Pis). It manages local iptables for traffic control, establishes reverse tunnels to the C2 server, and can emulate various services (SSH, HTTP, FTP) to trap attackers. It also collects telemetry like CPU usage and wireless signals."
    },
    {
        q: "How do I reset a 'Compromised' node?",
        a: "If a node is flagged as COMPROMISED, go to the Actor Detail view. You can either click 'Acknowledge Alert' to simply clear the status if it was a false positive, or use 'Factory Reset' to wipe the agent's local state, clear tunnels, and restart networking."
    },
    {
        q: "Is the traffic real or simulated?",
        a: "In 'Production' mode (connected to a database), the traffic logs are real events reported by your agents. In 'Mock' mode, the system generates simulated traffic patterns for demonstration and training purposes."
    },
    {
        q: "What network ports does the agent require?",
        a: "The agent primarily needs outbound HTTPS (TCP/443) access to the C2 server API. If using Tunneling/Traps, it may also require outbound TCP connections on ephemeral ports to the Trap Server. No inbound port forwarding on your firewall is strictly necessary for standard operation."
    },
    {
        q: "Can I run this on a VM instead of a Raspberry Pi?",
        a: "Yes! The installation script supports Ubuntu 20.04+, Debian 11+, and Kali Linux. You can deploy it on AWS EC2, a local VM, or even a Docker container (with --privileged mode for iptables access)."
    },
    {
        q: "What is 'Ghost Mode'?",
        a: "Ghost Mode is a high-interaction session recorder. When an attacker interacts with a projected Trap (like a fake Telnet service), the session is recorded keystroke-by-keystroke. You can replay these sessions in the Forensics tab to understand the attacker's methodology."
    }
];

const HelpCenter = () => {
    const [activeTab, setActiveTab] = useState<'TUTORIALS' | 'FAQ'>('TUTORIALS');
    const [openFaqIndex, setOpenFaqIndex] = useState<number | null>(0);

    return (
        <div className="p-6 max-w-6xl mx-auto animate-fade-in h-full flex flex-col">
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 shrink-0">
                <div>
                    <h2 className="text-3xl font-bold text-slate-200 flex items-center">
                        <LifeBuoy className="w-8 h-8 mr-3 text-blue-400" />
                        Help & Knowledge Base
                    </h2>
                    <p className="text-slate-500 text-sm mt-1">Documentation, guides, and support resources for Virtual Puppets.</p>
                </div>
                <div className="flex space-x-4 mt-4 md:mt-0">
                    <button 
                        onClick={() => setActiveTab('TUTORIALS')}
                        className={`px-6 py-2 rounded-lg font-bold text-sm transition-all flex items-center ${activeTab === 'TUTORIALS' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/20' : 'bg-slate-800 text-slate-400 hover:text-white'}`}
                    >
                        <Video className="w-4 h-4 mr-2" /> Tutorials
                    </button>
                    <button 
                        onClick={() => setActiveTab('FAQ')}
                        className={`px-6 py-2 rounded-lg font-bold text-sm transition-all flex items-center ${activeTab === 'FAQ' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/20' : 'bg-slate-800 text-slate-400 hover:text-white'}`}
                    >
                        <HelpCircle className="w-4 h-4 mr-2" /> Q & A
                    </button>
                </div>
            </div>

            <div className="flex-1 overflow-y-auto pr-2 pb-10">
                {activeTab === 'TUTORIALS' && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* Featured Video Placeholder */}
                        <div className="md:col-span-2 bg-slate-900 rounded-xl border border-slate-700 overflow-hidden relative group cursor-pointer aspect-video md:aspect-[3/1]">
                            <div className="absolute inset-0 bg-gradient-to-r from-slate-900 to-transparent z-10"></div>
                            {/* Mock Video UI */}
                            <div className="absolute inset-0 flex items-center justify-center z-20">
                                <div className="w-16 h-16 bg-blue-600/90 rounded-full flex items-center justify-center shadow-2xl group-hover:scale-110 transition-transform">
                                    <PlayCircle className="w-8 h-8 text-white ml-1" />
                                </div>
                            </div>
                            <div className="absolute bottom-0 left-0 p-8 z-20 max-w-2xl">
                                <span className="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded mb-3 inline-block">NEW FEATURE</span>
                                <h3 className="text-2xl font-bold text-white mb-2">Introduction to Wireless Reconnaissance</h3>
                                <p className="text-slate-300 text-sm">Learn how to use your deployed agents to passively map nearby Wi-Fi networks and Bluetooth devices to detect physical threats.</p>
                            </div>
                            {/* Background Pattern */}
                            <div className="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                        </div>

                        {TUTORIALS.map((tut) => (
                            <div key={tut.id} className={`p-6 rounded-xl border ${tut.border} bg-slate-800/50 hover:bg-slate-800 transition-all cursor-pointer group relative overflow-hidden`}>
                                <div className={`absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity`}>
                                    <tut.icon className="w-24 h-24" />
                                </div>
                                <div className="flex justify-between items-start mb-4 relative z-10">
                                    <div className={`p-3 rounded-lg ${tut.bg}`}>
                                        <tut.icon className={`w-6 h-6 ${tut.color}`} />
                                    </div>
                                    <span className="text-[10px] uppercase font-bold tracking-wider text-slate-500 bg-slate-900 px-2 py-1 rounded border border-slate-700">{tut.level}</span>
                                </div>
                                <h3 className="text-lg font-bold text-white mb-2 relative z-10 group-hover:text-blue-400 transition-colors">{tut.title}</h3>
                                <p className="text-slate-400 text-sm mb-4 relative z-10 h-10">{tut.description}</p>
                                <div className="flex items-center text-xs text-slate-500 font-mono relative z-10">
                                    <span className="flex items-center mr-4"><Video className="w-3 h-3 mr-1" /> {tut.time}</span>
                                    <span className="flex items-center text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity">Start Guide &rarr;</span>
                                </div>
                            </div>
                        ))}
                    </div>
                )}

                {activeTab === 'FAQ' && (
                    <div className="max-w-4xl mx-auto space-y-4">
                        <div className="bg-blue-900/20 border border-blue-500/30 p-4 rounded-lg mb-6 flex items-start">
                            <BookOpen className="w-5 h-5 text-blue-400 mr-3 mt-0.5" />
                            <div>
                                <h4 className="text-blue-300 font-bold text-sm mb-1">Documentation Library</h4>
                                <p className="text-blue-200/70 text-xs">For detailed API references, architecture diagrams, and security whitepapers, please visit our internal wiki.</p>
                                <a href="#" className="text-blue-400 text-xs font-bold mt-2 inline-flex items-center hover:underline">Open Wiki <ExternalLink className="w-3 h-3 ml-1"/></a>
                            </div>
                        </div>

                        {FAQS.map((faq, index) => {
                            const isOpen = openFaqIndex === index;
                            return (
                                <div key={index} className={`border rounded-lg transition-all duration-300 overflow-hidden ${isOpen ? 'bg-slate-800 border-blue-500/50' : 'bg-slate-900 border-slate-700 hover:border-slate-600'}`}>
                                    <button 
                                        onClick={() => setOpenFaqIndex(isOpen ? null : index)}
                                        className="w-full flex justify-between items-center p-4 text-left focus:outline-none"
                                    >
                                        <span className={`font-bold text-sm ${isOpen ? 'text-blue-400' : 'text-slate-300'}`}>{faq.q}</span>
                                        {isOpen ? <ChevronUp className="w-4 h-4 text-blue-500" /> : <ChevronDown className="w-4 h-4 text-slate-500" />}
                                    </button>
                                    {isOpen && (
                                        <div className="px-4 pb-4 text-slate-400 text-sm leading-relaxed border-t border-slate-700/50 pt-3 animate-fade-in">
                                            {faq.a}
                                        </div>
                                    )}
                                </div>
                            );
                        })}

                        <div className="mt-12 text-center pt-8 border-t border-slate-800">
                            <p className="text-slate-500 text-sm mb-4">Still need help? Our security engineers are available 24/7.</p>
                            <button className="bg-slate-800 hover:bg-slate-700 text-white px-6 py-2 rounded-full font-bold text-sm transition-colors border border-slate-600">
                                Contact Support
                            </button>
                        </div>
                    </div>
                )}
            </div>
        </div>
    );
};

export default HelpCenter;
